{% extends 'base.html' %}
{% load static %}

{% block title %} Liste des services {% endblock title %}
{% block sidebarre %} {% include 'navbar.html' %} {% endblock sidebarre %}
{% block content %}

<div class="content-body">
    <div class="container-fluid">
        
        <div class="row page-titles">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active"><a href="javascript:void(0)">Produits</a></li>
                <li class="breadcrumb-item"><a href="javascript:void(0)">Liste des services</a></li>
            </ol>
        </div>
        <!-- row -->

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#NouveauServiceModal">
                            Nouveau service
                           </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="example3" class="display" style="min-width: 100%">
                                <thead>
                                    <tr>
                                        <th>Designation</th>
                                        <th>Référence</th>
                                        <th>Prix</th>
                                        <th>Disponibilité</th>
                                        <th>Crée le</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="serviceItemListeTableBody">
                                    
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- The Modal -->
<div class="modal fade" id="NouveauServiceModal" tabindex="-1" aria-labelledby="NouveauServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="cNouveauServiceModalLabel">Nouveau service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                
                    <div class="row">
                        <div class="col-lg-6">
                            <label for="new_service_name"><b>Désignation du service</b></label>
                            <input type="text" id="new_service_name" name="new_service_name" class="form-control" required>
                        </div>
                        <div class="col-lg-6">
                            <label for="new_service_ref"><b>Reférence</b></label>
                            <input type="text" id="new_service_ref" name="new_service_ref" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-lg-6">
                            <label for="new_service_tarif"><b>Tarif </b></label>
                            <input type="number" id="new_service_tarif" name="new_service_tarif" class="form-control" step="0.1" required>
                        </div>
                        <div class="col-lg-6">
                            <label for="new_prenom"><b>Mode de tarification</b></label>
                            <select name="type_tarification" class="form-control" id="type_tarification">
                                <option value="h">Horaire</option>
                                <option value="m">Mensuelle</option>
                                <option value="j">Jour</option>
                                <option value="a">Année</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-lg-12">
                            <label for="categorie">Catégorie du service</label>
                            <select name="categorie" class="form-control" id="categorie">
                                {% for cat in categorie %}
                                    <option value="{{cat.id}}">{{cat.label}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-lg-12">
                            <label for="dispo">Disponibilité</label>
                            <select class="form-control" name="dispo" id="dispo">
                                <option value="1">Disponible</option>
                                <option value="0">Non disponible</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-lg-12">
                            <label for="description">Description du service</label>
                            <textarea name="description" id="description" class="form-control"></textarea>
                        </div>
                    </div>
             
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                <button type="submit" class="btn btn-warning" id="addNewService">Confirmer</button>
            </div>
        </div>
    </div>
</div>
<script>

    $(document).ready(function(){

        loadItem();
        function loadItem(){
            $.ajax({
                url : "{% url 'commercial:ApiLoadService' %}",
                type : 'GET',
                success: function(data){
                    var row = "";

                    if(data.lenght>0){
                        $.each(data, function(index, p){

                            row += "<tr>";
                            row += "<td>"+p.designation+"</td>";
                            row += "<td>"+p.ref+"</td>";
                            row += "<td>"+p.prix_vente+"</td>";
                            row += "<td>"+p.disponibilite+"</td>";
                            row += "<td>"+p.created_at+"</td>";
                            row += "<td></td>";
                            row += "</tr>";

                        });
                    }else{
                        row += "<tr><td colspan='6' style='text-align:center;'><b>Aucun service, veuillez en créer !</b></td></tr>";
                    }

                    
                    $('#serviceItemListeTableBody').html(row);
                }
            });


        }
        
        $(document).on('click', '#addNewService', function(){

            var new_service_name = document.getElementById('new_service_name').value;
            var new_service_ref = document.getElementById('new_service_ref').value;
            var new_service_tarif = document.getElementById('new_service_tarif').value;
            var type_tarification = document.getElementById('type_tarification').value;
            var categorie = document.getElementById('categorie').value;
            var dispo = document.getElementById('dispo').value;
            var description = document.getElementById('description').value;

            $.ajax({
                url : "{% url 'commercial:AddNewService' %}",
                type : "POST",
                data : {
                    'new_service_name' :new_service_name,
                    'new_service_ref' : new_service_ref,
                    'new_service_tarif' :new_service_tarif,
                    'type_tarification' :type_tarification,
                    'categorie' :categorie,
                    'dispo' :dispo,
                    'description' : description,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                success: function(response){
                    response.messages.forEach(function(message) {
                        if (message.tags.includes('success')) {
                            alertify.success(message.message);
                        } else if (message.tags.includes('error')) {
                            alertify.error(message.message);
                        }
                    });
                    loadItem()
                    $('#NouveauServiceModal').modal('hide');

                }
            });
        });
    });
</script>


{% endblock content %}




